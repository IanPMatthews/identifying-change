<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>
  body { background-color: white; margin: 0; }
  #plot { width: 100%; height: 90vh; }
</style>

<!-- Load libraries -->
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<title>d18O Record with Annotations</title>
</head>
<body>

<div id="plot"></div>

<script>
// --- Full dataset copied from your R export ---
var trace = {
  x: [8000,8020,8040,8060,8080,8100,8120,8140,8160,8180,8200,8220,8240,8260,8280,8300,8320,8340,8360,8380,8400,8420,8440,8460,8480,8500,8520,8540,8560,8580,8600,8620,8640,8660,8680,8700,8720,8740,8760,8780,8800,8820,8840,8860,8880,8900,8920,8940,8960,8980,9000,9020,9040,9060,9080,9100,9120,9140,9160,9180,9200,9220,9240,9260,9280,9300,9320,9340,9360,9380,9400,9420,9440,9460,9480,9500,9520,9540,9560,9580,9600,9620,9640,9660,9680,9700,9720,9740,9760,9780,9800,9820,9840,9860,9880,9900,9920,9940,9960,9980,10000,10020,10040,10060,10080,10100,10120,10140,10160,10180,10200,10220,10240,10260,10280,10300,10320,10340,10360,10380,10400,10420,10440,10460,10480,10500,10520,10540,10560,10580,10600,10620,10640,10660,10680,10700,10720,10740,10760,10780,10800,10820,10840,10860,10880,10900,10920,10940,10960,10980,11000,11020,11040,11060,11080,11100,11120,11140,11160,11180,11200,11220,11240,11260,11280,11300,11320,11340,11360,11380,11400,11420,11440,11460,11480,11500,11520,11540,11560,11580,11600,11620,11640,11660,11680,11700,11720,11740,11760,11780,11800,11820,11840,11860,11880,11900,11920,11940,11960,11980,12000,12020,12040,12060,12080,12100,12120,12140,12160,12180,12200,12220,12240,12260,12280,12300,12320,12340,12360,12380,12400,12420,12440,12460,12480,12500,12520,12540,12560,12580,12600,12620,12640,12660,12680,12700,12720,12740,12760,12780,12800,12820,12840,12860,12880,12900,12920,12940,12960,12980,13000,13020,13040,13060,13080,13100,13120,13140,13160,13180,13200,13220,13240,13260,13280,13300,13320,13340,13360,13380,13400,13420,13440,13460,13480,13500,13520,13540,13560,13580,13600,13620,13640,13660,13680,13700,13720,13740,13760,13780,13800,13820,13840,13860,13880,13900,13920,13940,13960,13980,14000,14020,14040,14060,14080,14100,14120,14140,14160,14180,14200,14220,14240,14260,14280,14300,14320,14340,14360,14380,14400,14420,14440,14460,14480,14500,14520,14540,14560,14580,14600],
  y: [-33.72,-34.07,-34.07,-34.55,-34.54,-35.48,-35.03,-34.99,-34.62,-34.89,-35.60,-36.23,-36.17,-36.07,-35.94,-35.01,-35.95,-33.95,-34.89,-34.77,-34.99,-34.20,-35.82,-33.67,-33.44,-34.51,-35.37,-34.32,-34.49,-35.11,-34.88,-35.66,-34.60,-34.06,-34.64,-34.61,-34.89,-35.80,-34.40,-34.57,-34.71,-35.03,-34.69,-34.56,-34.68,-33.96,-34.98,-34.68,-33.66,-34.05,-35.15,-34.60,-34.32,-34.41,-34.80,-34.84,-34.98,-34.73,-34.60,-35.23,-34.55,-34.42,-34.05,-34.42,-34.90,-34.93,-35.05,-36.22,-35.68,-34.86,-35.35,-34.46,-34.28,-35.74,-35.19,-34.50,-34.88,-34.76,-34.58,-34.58,-34.77,-35.49,-34.80,-34.94,-35.10,-35.85,-34.92,-34.27,-34.95,-35.33,-35.12,-34.66,-35.04,-34.51,-35.02,-35.10,-35.03,-35.16,-34.93,-35.46,-34.87,-35.60,-34.67,-35.15,-34.65,-34.36,-35.60,-35.54,-34.74,-35.27,-35.37,-35.68,-34.99,-34.54,-35.05,-35.95,-35.87,-35.97,-36.40,-35.56,-35.57,-36.10,-35.80,-36.62,-36.74,-36.20,-36.19,-36.95,-36.02,-35.73,-35.55,-36.27,-35.47,-36.31,-36.03,-36.23,-36.64,-36.31,-35.73,-36.10,-36.35,-36.73,-35.61,-36.32,-37.07,-35.57,-36.76,-36.17,-37.63,-37.07,-37.36,-37.16,-37.16,-38.02,-36.60,-37.22,-36.59,-36.55,-37.17,-36.66,-36.88,-36.30,-37.25,-36.79,-37.67,-36.99,-37.96,-37.25,-34.32,-36.81,-37.56,-36.54,-36.72,-37.76,-38.04,-37.45,-38.62,-38.24,-38.74,-36.84,-38.23,-37.03,-36.36,-36.85,-37.02,-36.65,-36.79,-36.20,-38.51,-38.71,-40.15,-40.27,-40.12,-40.23,-39.97,-40.42,-40.80,-39.38,-39.34,-41.23,-40.05,-41.03,-40.96,-41.35,-40.68,-40.20,-40.13,-39.40,-40.23,-40.89,-41.76,-40.68,-41.68,-41.58,-39.69,-41.04,-41.26,-39.53,-41.03,-41.14,-40.37,-40.91,-41.65,-41.41,-40.80,-41.08,-40.90,-41.88,-40.00,-41.91,-40.76,-39.26,-40.71,-40.47,-41.33,-41.84,-41.64,-41.39,-40.92,-41.81,-42.23,-41.73,-41.01,-40.05,-40.16,-40.39,-39.84,-39.28,-39.55,-40.27,-39.21,-37.80,-38.23,-39.17,-38.62,-39.67,-39.51,-39.80,-40.20,-39.90,-40.24,-40.65,-41.52,-39.81,-40.52,-40.11,-40.59,-39.47,-39.04,-39.14,-38.97,-39.31,-38.85,-38.64,-38.65,-38.60,-38.18,-38.84,-38.11,-38.07,-38.10,-37.40,-38.03,-39.31,-38.92,-39.83,-40.13,-38.93,-39.29,-38.67,-38.41,-37.94,-38.76,-39.53,-38.99,-37.94,-39.09,-38.25,-37.68,-38.04,-38.46,-38.49,-38.23,-40.02,-39.38,-39.77,-40.46,-40.25,-40.07,-38.55,-38.14,-37.98,-38.90,-37.89,-37.89,-37.60,-38.53,-37.72,-36.75,-37.53,-36.81,-37.74,-36.77,-37.71,-35.35,-37.27,-37.17,-37.59,-36.56,-35.72,-35.65,-35.71,-36.31,-37.38,-36.23,-36.61,-37.69,-37.40,-37.89,-42.00,-41.88,-42.38,-40.87,-40.86,-40.30,-41.37,-41.68,-41.22,-40.86,-40.86,-41.67],
  mode: 'lines',
  type: 'scatter',
  line: { color: 'blue' },
  name: 'd18O record'
};

var layout = {
  xaxis: { title: "Age" },
  yaxis: { title: "Î´18O" },
  title: "Click to Annotate",
  margin: { t: 50, l: 70, r: 20, b: 60 }
};

// --- Initialize plot ---
Plotly.newPlot('plot', [trace], layout);

// --- Annotation + SheetDB upload ---
document.getElementById("plot").on('plotly_click', function(data) {
  var x = data.points[0].x;
  var y = data.points[0].y;

  Plotly.addTraces('plot', {
    x: [x],
    y: [y],
    type: 'scatter',
    mode: 'markers',
    marker: { color: 'red', size: 10 },
    name: 'Student Annotation'
  });

  fetch("https://sheetdb.io/api/v1/rb8zgntocyoom", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      data: [{ time: x, value: y }]
    })
  })
  .then(res => {
    if (!res.ok) throw new Error(res.statusText);
    console.log("Annotation sent:", x, y);
  })
  .catch(err => console.error("Error sending annotation:", err));
});
</script>

</body>
</html>

