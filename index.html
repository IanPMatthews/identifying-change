<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Student Annotation Graph</title>
  <style>body{background-color:white;}</style>

  <!-- Plotly JS -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>Click on the graph to annotate where you observe change</h2>
  <div id="plot" style="width:100%;height:500px;"></div>

  <script>
    // Sample time series data
    var trace1 = {
      x: ["2025-11-01", "2025-11-02", "2025-11-03"],
      y: [10, 15, 12],
      mode: 'lines',
      type: 'scatter',
      name: 'Original Data'
    };

    var layout = {
      title: 'Time Series Graph',
      xaxis: { title: 'Time' },
      yaxis: { title: 'Value' }
    };

    Plotly.newPlot('plot', [trace1], layout);

    // Click handler
    var plotDiv = document.getElementById('plot');
    plotDiv.on('plotly_click', function(data) {
      var x = data.points[0].x;
      var y = data.points[0].y;

      // Add annotation marker
      Plotly.addTraces(plotDiv, {
        x: [x],
        y: [y],
        type: 'scatter',
        mode: 'markers',
        marker: { color: 'red', size: 10 },
        name: 'Student Annotation'
      });

      // Send to Google Sheet via SheetDB
      fetch("https://sheetdb.io/api/v1/rb8zgntocyoom", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: [{ time: x, value: y }] })
      })
      .then(response => {
        if (!response.ok) {
          console.error("Failed to send annotation:", response.statusText);
        } else {
          console.log("Annotation sent successfully");
        }
      })
      .catch(error => {
        console.error("Fetch error:", error);
      });
    });
  </script>
</body>
</html>
