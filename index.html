<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>
  body { background-color: white; margin: 0; }
  #plot { width: 100%; height: 90vh; }
</style>

<!-- Include dependencies directly from CDNs -->
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<title>Interactive Annotation Plot</title>
</head>
<body>

<div id="plot"></div>

<script>
// Create the base plot
var trace = {
  x: [8000, 8020, 8040, 8060, 8080, 8100, 8120, 8140],
  y: [-33.7, -34.1, -34.5, -34.9, -35.3, -35.5, -35.8, -36.1],
  mode: 'lines',
  type: 'scatter',
  line: { color: 'blue' },
  name: 'd18O record'
};

var layout = {
  xaxis: { title: "Age" },
  yaxis: { title: "Î´18O" },
  title: "Click to Annotate"
};

Plotly.newPlot('plot', [trace], layout);

// --- Annotation & Google Sheet logging ---
document.getElementById("plot").on('plotly_click', function(data) {
  var x = data.points[0].x;
  var y = data.points[0].y;

  // Add red marker where clicked
  Plotly.addTraces('plot', {
    x: [x],
    y: [y],
    type: 'scatter',
    mode: 'markers',
    marker: { color: 'red', size: 10 },
    name: 'Student Annotation'
  });

  // Send to Google Sheet via SheetDB (replace with your API endpoint)
  fetch("https://sheetdb.io/api/v1/rb8zgntocyoom", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      data: [{ time: x, value: y }]
    })
  })
  .then(res => {
    if (!res.ok) throw new Error(res.statusText);
    console.log("Annotation sent:", x, y);
  })
  .catch(err => console.error("Error sending annotation:", err));
});
</script>

</body>
</html>
